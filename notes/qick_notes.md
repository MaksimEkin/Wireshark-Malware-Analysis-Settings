# **QUICK NOTES**
> *Reference: http://www.malware-traffic-analysis.net/about.html*


**Show HTTP Requests**
~~~ruby
http.request
~~~
**HTTP traffic over UDP port 1900 as Simple Service Discovery Protocol**
~~~ruby
ssdp
!ssdp
!(udp.port eq 1900
~~~
**Filter DNS and IP address**
~~~ruby
dns and ip.addr != 10.0.0.0
~~~
**Show Domain names used in HTTPS or SSL/TLS traffic**
~~~ruby
ssl.handshake.type == 1
~~~
**Infected host may try to connect to a server that has been taken off or is refusing TCP connection. This can be revealed using TCP SYN segments in filter.**
~~~ruby
tcp.flags eq 0x0002
(http.request or ssl.handshake.type == 1 or tcp.flags == 0x0002) and !(ssdp)
~~~
**Post infection based traffic may not be web-based. Infected host will contact Command and Control (C2 or C&C) hosted by IP address or or with domain names by Remote Access Tool (that isn’t HTTP or HTTPS/SSL/TLS). So look for DNS.**
~~~ruby
dns
(http.request or ssl.handshake.type == 1 or tcp.flags == 0x0002) and !(ssdp)
~~~
**Filter to display FTP traffic which malware can use to transfer files**
~~~ruby
ftp
~~~
**Spambot malware can send dozens to hundreds email by several DNS requests to various mail servers. SMTP traffic on TCP ports 25, 465, 587**
**If it is STARTLS it is most likely encrypted email.**
~~~ruby
(http.request or ssl.handshake.type == 1 or tcp.flags eq 0x0002 or dns) and !(udp.port eq 1900)
smtp
smtp contains “From: “
smtp contains “Message-ID: “
smtp contains “Subject: “
~~~
**DHCP traffic can help identify type of computer connected to the network.To reveal DHCP traffic: After that, client identifier should reveal MAC address.** 
~~~ruby
bootp
dhcp 
~~~
**DHCP traffic may not be available. NBNS (NetBIO Name Service) traffic is generated primarily by Microsoft Windows or Apple hosts running MacOS.** 
~~~ruby
nbns 
~~~
**For Windows hosts in Active Directory (AD) environment, we can find account names in from Kerberos traffic. Hostnames end with dollar sign, but user names doesn’t.** 
~~~ruby
kerberos.CNameString
kerberos.CNameString and !(kerberos.CNameString contains $)
~~~
**See applicable account name, password and file being used through FTP channel**
~~~ruby
(ftp.request.command eq USER) or (ftp.request.command eq PASS) or (ftp.request.command eq STOR)
~~~
**To see files being sent through FTP**
~~~ruby
ftp-data
~~~
**Filter to find any torrent hashes of the files being downloaded or shared**
~~~ruby
bittorrent.info_hash
~~~
**Find torrent announce requests over http by a torrent tracker**
~~~ruby
(torrent contains scrape or torrent contains announce) and http.request 
~~~






